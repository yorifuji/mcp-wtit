# アーキテクチャ

## 概要

このMCPサーバーは、クリーンアーキテクチャの原則に基づいて設計されています。ビジネスロジックを中心に配置し、外部への依存を最小限に抑えることで、テスタブルで保守しやすいコードベースを実現しています。

## レイヤー構造

### 1. ドメイン層 (`src/domain/`)

- **責務**: ビジネスロジックとビジネスルールの実装
- **依存**: なし（完全に独立）
- **主要コンポーネント**:
  - `interfaces/`: ドメインサービスのインターフェース定義
  - `services/`: ビジネスロジックの実装（TimeService）

### 2. アプリケーション層 (`src/application/`)

- **責務**: ユースケースの実装とアプリケーション固有のビジネスルール
- **依存**: ドメイン層のみ
- **主要コンポーネント**:
  - `interfaces/`: ユースケースのインターフェース定義
  - `usecases/`: ユースケースの実装
    - GetCurrentTimeUseCase
    - GetISO8601TimeUseCase

### 3. インフラストラクチャ層 (`src/infrastructure/`)

- **責務**: 外部システムとの統合（MCP SDK）
- **依存**: アプリケーション層、ドメイン層
- **主要コンポーネント**:
  - `mcp/`: MCPサーバーの実装

### 4. 共有層 (`src/shared/`)

- **責務**: 全レイヤーで共有される型定義とユーティリティ
- **主要コンポーネント**:
  - `types/`: 共通の型定義
  - `errors/`: カスタムエラークラス

### 5. 依存性注入 (`src/di/`)

- **責務**: オブジェクトの生成と依存関係の管理
- **主要コンポーネント**:
  - `container.ts`: シングルトンパターンによるDIコンテナ

## データフロー

```
MCPクライアント
    ↓
TimeServer (Infrastructure)
    ↓
UseCase (Application)
    ↓
TimeService (Domain)
```

## 設計原則

### SOLID原則

1. **単一責任の原則**: 各クラスは単一の責務を持つ
2. **オープン・クローズドの原則**: 拡張に対して開き、修正に対して閉じている
3. **リスコフの置換原則**: インターフェースを通じた抽象化
4. **インターフェース分離の原則**: 必要最小限のインターフェース
5. **依存性逆転の原則**: 上位レイヤーは下位レイヤーに依存しない

### テスタビリティ

- 各レイヤーが独立してテスト可能
- インターフェースを使用したモックの容易な作成
- 純粋関数の活用

## 技術スタック

- **言語**: TypeScript 5.6+
- **モジュールシステム**: ESModules
- **テスト**: Vitest
- **リント**: ESLint 9
- **ビルド**: TypeScript Compiler
- **実行環境**: Node.js 18+